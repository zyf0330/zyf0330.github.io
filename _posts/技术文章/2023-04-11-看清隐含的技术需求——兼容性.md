---
layout: post
title: '看清隐含的技术需求——兼容性.md'
date: 2023-04-11
category: 技术文章
---

## 背景

我们要做的大大小小的功能，一般都源于业务需求。在实现这些功能的过程中，经常会涉及到兼容性的考虑。

大多数时候，兼容性都是一个技术需求。今天就拿一个具体的场景作为例子，解释一下，为什么以及怎么解决。



## 例子

> 这个例子是服务端基础库最近的一个改动，我会抽象的描述它。



一个模块的现有版本，设计了一个抽象方法，这个方法既会被内部使用，也会被外部使用。

这个方法存在一些性能问题，所以希望设计一个新的性能更好的方法来代替它。这是需求。

但是现实世界总是要考虑向后兼容性的，要让使用者自己决定实现新方法的时机来做到平滑升级，实现了才调用。这也是需求。



第一个需求是  **业务需求**  ，它能支撑所有使用者最终迁移到新版性能更好的模块。

而第二个需求，一般来说都被算作是  **技术需求**  。技术需求是为业务需求提供辅助支持的。换言之，如何让使用者更舒服的升级迁移，这就是一门技术。



> 业务和技术这一对概念是相对的。



##### 第一版的技术方案

在模块构造时传入一个选项，指示内部逻辑该使用旧的方法还是新的方法，这样的话，在实现了新方法后，才修改指示。

这个方案的问题是，身为技术需求却需要业务方（模块使用方）对接。体现在：

1. 外部使用者需要了解和指示内部逻辑
1. 这个选项的指示能力是弱的、间接的


总结就是，采用了一种差劲的技术手段差劲地实现了技术需求。



> 至于选项名称、方法名称起的不合适，无法直观地体现上述意图，就稍显不重要了。



##### 更好的技术方案

使用 TS 的特性，  **可选方法**  ，来支持这个技术需求，是个更好的办法。使用者升级新版模块后，可以稍后再实现。

> 就像可选属性一样，在抽象方法后面加个问号，就可以让这个方法成为可选实现的。

这样的话，技术需求就不需要业务方对接了。好处体现在：

1. 外部使用者不需要了解和介入内部逻辑
1. 是否实现可选方法是个强指示：内部逻辑只需要判断方法是否被实现，即可决定调用新的还是旧的




## 总结

技术的重要性可见一斑。所以技术越高，需求也越好实现。

