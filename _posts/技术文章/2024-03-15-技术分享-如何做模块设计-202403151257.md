---
layout: post
title: '技术分享-如何做模块设计-202403151257.md'
date: 2024-03-15
category: 技术文章
---


> 实践部分是后端场景，但是理论部分前端也适用。前端可以听。



# 背景

大家都是一线开发人员，所以今天的重头戏是实践讲解，俗称接地气。不过理论是必不可少的。



## 为什么要分享这个主题

- 形式因：模块设计始终是工作中非常重要的一块
- 动力因：今年后端工作组单独设立了后端架构组，用来评审设计方案；另外工作组也希望能提高模块实现的质量
- 目的因：对有志于设计出优秀模块，或苦于如何难以设计优秀模块的人有所帮助


## 为什么要做模块设计

不做设计，那就是写到哪儿想到哪儿，产出一团乱麻。



设身处地，从普通开发人员角度

- 首要就是可维护：降低认知负担，提高开发效率，使自己的时间有节余，免于后期维护深陷各种 bug 修复的泥潭
- 间接好处：成长
    - 节省同事的时间，提高团队效率
    - 提高代码质量和服务能力
    - 服务可扩展性扩容性
    - ......


## 为什么设计方案需要经过评审

- 简单的需求：基本熟练掌握
    - 业务需求简单，业务逻辑增删改查，业务单元线性无交叉
    - 通用的 Facade - Service - Repository - Entity 结构
- 复杂的需求
    - 业务需求各式各样，逻辑复杂，业务单元互相联系
    - 最优结构或架构也相应的各不一样




# 原则

接下来讲的，和很多人的设计或评审经验不符，需要仔细思考。



**面向业务设计！！！**

我们的目的是设计出  **刚好够用**  同时好用的模块，连可扩展性都不特意考虑。



先解释一下什么是刚好够用，就是在准确反映业务需求的基础上：

- 不做多余的可扩展性
- 不做多余的功能限制或开放




为什么呢？因为我们面向业务设计，如果业务发生：

- 破坏性变更：直接丢弃这个刚好够用的模块。这样的模块在开发时必然没有为了其他目的付出多余的一丝精力，弃之不可惜。
- 扩展性变更：由于刚好够用，意味着高内聚低耦合，可以作为更大模块的子模块。




最反映业务的就是 Service （泛指），称为  **业务逻辑**  ；还有诸如 Entity、Info 等，称为  **业务实体**  （业务对象）。

针对后端内部的设计评审，这两块，尤其是 Service，才是最主要的要讲解的部分。

其他一般概念：

- Repository、Entity
    - 存储数据结构，业务无关。但是通常会和业务实体的概念耦合在一起
- Facade、RPC
    - 对外接口层，反映业务功能，但本身不承载业务逻辑




# 实践

用  **仪表盘**  产品需求来做例子，这个比最基础的业务稍微复杂一些。

带着需求考虑旧的技术实现是否可以复用



## 最新需求

- 仿照 Ladon 仪表盘和部件的展示和管理
- **部件由各子应用提供，且支持互相加载**
    - 决定性差别


## 原有相似产品功能和技术实现

> 99%的需求和实现都是在抄，借鉴已有的产品需求实现

### Ladon 仪表盘

产品需求：仪表盘管理、部件排布、编辑和展示部件内容

技术实现：Ladon dashboard 模块

### Project 项目概览

产品需求：静态仪表盘，不可管理编辑仪表盘、排布部件等

技术实现：使用 eros widget 模块，复制于 Ladon 的 dashboard - widget 模块，基本无功能差别。

### Insight 报表仪表盘

产品需求：编辑报表部件时刷新内容

## 最新需求的设计方案

### 分析需求

产品需求一般是能线性映射为技术需求的

- 业务逻辑角色
- 技术实现


### 设计的实现

看 pc-core 的最新的 widget 模块



# 问题

- 你觉得常见的模块，是面向对象的还是面向过程的？

